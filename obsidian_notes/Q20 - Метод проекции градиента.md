# Вопрос 20. Численные методы решения задач нелинейного программирования. Метод проекции градиента.

**Где читать в учебнике:**
*   **Стр. 207:** Идея и определение проекции.
*   **Стр. 208:** Алгоритм и формулы.

**Задача:**
$$ f(x) \to \min, \quad x \in U $$
$U$ — выпуклое замкнутое множество (задается ограничениями).

---

## 1. Суть метода (Объяснение на пальцах)

> [!example] Мячик и стена
> Представь, что ты хочешь попасть в центр комнаты, но на пути стоит стеклянная стена (ограничение).
>
> 1.  **Попытка шага:** Ты (точка $x^k$) видишь цель и делаешь шаг прямо к ней (по антиградиенту).
> 2.  **Проверка:**
>     *   Если ты не ударился о стену — отлично, оставайся там.
>     *   Если ты ударился и «вылетел» за пределы дозволенного — это проблема.
> 3.  **Проекция:** Ты не можешь стоять за стеной. Ты должен вернуться в допустимую зону. Какая точка стены ближе всего к тому месту, куда ты вылетел?
>     Ты просто опускаешь перпендикуляр на стену. Это и есть **проекция**.
>
> **Итог:** Метод делает шаг градиентного спуска, а если вылетает за границы, «сплющивает» точку обратно на границу множества.

---

## 2. Математическая формулировка

Вводится оператор **проектирования** точки $z$ на множество $U$:
$$ P_U(z) = \text{argmin} \{ \|z - y\| \mid y \in U \} $$
*По-русски:* $P_U(z)$ — это такая точка $y$ из множества $U$, которая находится ближе всего к точке $z$.

**Итерационный процесс:**
$$ x^{k+1} = P_U \left( x^k - \alpha_k \nabla f(x^k) \right) $$

Где:
1.  $x^k$ — текущая точка.
2.  $-\alpha_k \nabla f(x^k)$ — обычный шаг градиентного спуска (без учета ограничений).
3.  $P_U(\dots)$ — возвращение результата на «землю» (в допустимую область).

---

## 3. Алгоритм (Пошагово)

> [!info] Алгоритм метода проекции градиента
>
> **Шаг 1.** Вычисляем антиградиент в текущей точке: $-\nabla f(x^k)$.
>
> **Шаг 2.** Делаем "пробный шаг" (как будто ограничений нет):
> $$ \tilde{x} = x^k - \alpha_k \nabla f(x^k) $$
>
> **Шаг 3.** Проверяем, попали ли мы в $U$?
> *   Если $\tilde{x} \in U$, то $x^{k+1} = \tilde{x}$.
> *   Если $\tilde{x} \notin U$, то ищем проекцию:
>     $$ x^{k+1} = P_U(\tilde{x}) $$
>     (Для простых множеств, типа квадрата или шара, проекция ищется по готовым формулам. Для сложных — нужно решать отдельную мини-задачу квадратичного программирования).
>
> **Шаг 4.** Проверяем условия остановки (например, если $x^{k+1}$ почти совпадает с $x^k$).

---
## 4. Виды проекций на множества (Формулы из лекций)

На практике проекция $P_U(x)$ считается по-разному в зависимости от того, как выглядит наше множество $U$.

> [!info] Случай 1. Неотрицательный ортант (Угол)
> Множество: $U = \{ x \mid x_i \ge 0 \}$.
> *   Если координата положительная — не трогаем.
> *   Если отрицательная — зануляем.
>
> **Формула:**
> $$
> \bar{x}_i =
> \begin{cases}
> x_i, & \text{если } x_i \ge 0 \\
> 0, & \text{если } x_i < 0
> \end{cases}
> $$

> [!info] Случай 2. Параллелепипед (Коробка)
> Множество: $U = \{ x \mid a_i \le x_i \le b_i \}$.
> Мы "обрезаем" значения, выходящие за рамки.
>
> **Формула:**
> $$
> \bar{x}_i =
> \begin{cases}
> a_i, & \text{если } x_i \le a_i \\
> x_i, & \text{если } a_i \le x_i \le b_i \\
> b_i, & \text{если } x_i \ge b_i
> \end{cases}
> $$

> [!info] Случай 3. Шар (Сфера)
> Множество: $U = \{ x \mid \|x - x_0\| \le R \}$.
> *   Если точка внутри шара — оставляем ($x$).
> *   Если снаружи — сжимаем вектор $(x - x_0)$ до длины $R$.
>
> **Формула:**
> $$
> P_U(x) =
> \begin{cases}
> x, & \text{если } x \in U \\
> x_0 + (x - x_0) \cdot \frac{R}{\|x - x_0\|}, & \text{если } x \notin U
> \end{cases}
> $$

> [!info] Случай 4. Гиперплоскость (Линейное равенство)
> Множество: $U = \{ x \mid \langle a, x \rangle = b \}$.
> Проекция точки $x$ на плоскость — это опускание перпендикуляра.
>
> **Формула:**
> $$ \bar{x} = x + \frac{a}{\|a\|} \cdot \rho(x, L) $$
> Где $\rho$ — расстояние от точки до плоскости (со знаком):
> $$ \rho(x, L) = \frac{b - \langle a, x \rangle}{\|a\|} $$
>
> *Итоговая формула:*
> $$ \bar{x} = x + a \cdot \frac{b - \langle a, x \rangle}{\|a\|^2} $$




## 4. Численный пример

**Задача:**
$$ f(x) = (x_1 - 2)^2 + (x_2 - 2)^2 \to \min $$
*(Мы хотим попасть в точку $(2, 2)$)*.
**Ограничение:**
$$ x_1 \le 1, \quad x_2 \le 1 $$
*(Мы заперты в квадрате $1 \times 1$. Очевидно, что решение будет в углу $(1, 1)$, так как это самая близкая точка квадрата к $(2, 2)$).*

**Итерация 1:**
*   Начальная точка: $x^0 = (0.5, 0.5)$.
*   Градиент: $\nabla f = (2(x_1-2), 2(x_2-2))$.
    В точке $(0.5, 0.5)$: $\nabla f = (2(-1.5), 2(-1.5)) = (-3, -3)$.
*   Антиградиент (куда хотим идти): $(3, 3)$.
*   Пусть шаг $\alpha = 0.5$.

**Пробный шаг:**
$$ \tilde{x} = (0.5, 0.5) + 0.5 \cdot (3, 3) = (0.5 + 1.5, 0.5 + 1.5) = (2, 2) $$
Мы попали в идеальную точку $(2, 2)$.

**Проверка и Проекция:**
*   Точка $(2, 2)$ нарушает ограничения ($2 \not\le 1$). Она вне квадрата.
*   Нам нужно спроецировать $(2, 2)$ на квадрат $x_1 \le 1, x_2 \le 1$.
*   Какая точка квадрата ближе всего к $(2, 2)$?
    Это угол $(1, 1)$.
*   **Результат:** $x^1 = (1, 1)$.

Мы нашли решение за один шаг с проекцией!

---

## 5. Навигация
<< [[Q19 - Метод возможных направлений]] | [[00_ПЛАН_ПОДГОТОВКИ]] | [[Q21 - Метод штрафных функций]] >>
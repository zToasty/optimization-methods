# Вопрос 21. Метод штрафных функций (внешних штрафов).

**Где читать в учебнике:**
*   **Стр. 215:** Идея и графическая иллюстрация (Рис. 5.6).
*   **Стр. 216:** Формулы и алгоритм.

**Проблема:** У нас есть ограничения $x \in U$. Из-за них мы не можем просто взять производную и приравнять к нулю.
**Идея:** А давайте уберем ограничения («снесём забор»), но введем **штраф** за выход на запретную территорию. Если штраф будет очень большим, искать минимум в запретной зоне станет невыгодно, и решение само «прижмется» к допустимой области.

---

## 1. Суть метода (Объяснение на пальцах)

> [!example] Парковка на газоне
> **Задача:** Ты хочешь припарковать машину как можно ближе к подъезду ($f(x) \to \min$).
> **Ограничение:** Перед подъездом газон, парковаться там нельзя ($U$).
>
> **Метод штрафов:**
> Физического забора нет. Ты можешь заехать на газон. Но там стоит полицейский и выписывает штраф.
>
> 1.  **День 1 (Штраф $A_1 = 100$ руб):** Ты думаешь: «Ай, заплачу!» и паркуешься прямо у двери (глубоко в запретной зоне). С учетом штрафа тебе это выгодно.
> 2.  **День 2 (Штраф $A_2 = 10 000$ руб):** Дороговато. Ты отъезжаешь на самый краешек газона.
> 3.  **День 3 (Штраф $A_3 = 1 000 000$ руб):** Ты паркуешься ровно в миллиметре от газона, на асфальте.
>
> **Итог:** Увеличивая штраф до бесконечности, мы заставляем оптимальное решение (с учетом штрафа) совпасть с решением исходной задачи.

---

## 2. Математическая формулировка

Мы заменяем исходную задачу $f(x) \to \min, g_i(x) \le 0$ на задачу **безусловной** минимизации вспомогательной функции:

$$ \Phi_k(x) = f(x) + A_k \cdot P(x) \to \min $$

Где:
1.  $f(x)$ — наша родная целевая функция.
2.  $A_k$ — **штрафной коэффициент**. Это числовая последовательность, стремящаяся к бесконечности ($1, 10, 100, \dots \to \infty$).
3.  $P(x)$ — **функция штрафа**. Она должна быть:
    *   $P(x) = 0$, если мы в допустимой области (правила не нарушены).
    *   $P(x) > 0$, если мы нарушили правила.

**Стандартный вид функции штрафа** (квадратичный штраф):
$$ P(x) = \sum_{i=1}^{m} [\max \{0, g_i(x)\}]^2 $$
*(Если $g(x) = -5$, то $\max(0, -5)=0$, штрафа нет. Если $g(x)=3$, то штраф $3^2=9$).*

> [!info] Свойства функции штрафа $\varphi_k(x) = A_k P(x)$
> Чтобы метод сходился, последовательность штрафных функций должна обладать свойствами:
> 1.  Если $x \in U$ (допустимая точка), то предел штрафа при $k \to \infty$ равен **0**.
> 2.  Если $x \notin U$ (нарушение), то предел штрафа при $k \to \infty$ равен **$+\infty$**.
>
> *Смысл:* В пределе мы получаем задачу с бесконечными барьерами, которые запрещают выходить за границы.


---

## 3. Алгоритм

> [!info] Алгоритм
> **Шаг 0.** Выбрать начальную точку $x^0$, начальный штраф $A_0 > 0$, коэффициент роста $\beta > 1$ (обычно 10).
>
> **Шаг 1 (k-я итерация).**
> Составляем функцию: $\Phi_k(x) = f(x) + A_k P(x)$.
> Находим её **безусловный минимум** любым методом (например, методом Ньютона или градиентного спуска). Назовем найденную точку $x^*(A_k)$.
> *   *Важно:* Эта точка скорее всего будет лежать **вне** допустимой области (немного нарушать правила).
>
> **Шаг 2.** Проверяем, достаточно ли мало нарушение ограничений ($P(x^*) < \varepsilon$).
> *   Если да — стоп. $x^*$ — решение.
> *   Если нет — увеличиваем штраф: $A_{k+1} = \beta \cdot A_k$. Возвращаемся к Шагу 1.

---

## 4. Численный пример

**Задача:**
Найти минимум $f(x) = x$ при условии $x \ge 2$ (то есть $2 - x \le 0$).
*(Очевидный ответ: минимум в точке $x=2$, значение 2).*

**Применим метод штрафов:**
Ограничение $g(x) = 2 - x$.
Функция штрафа: $P(x) = (\max(0, 2-x))^2$. Если $x < 2$, штраф равен $(2-x)^2$.

Составим функцию $\Phi(x, A)$:
$$ \Phi(x) = x + A \cdot (2 - x)^2 $$
Найдем минимум этой функции (возьмем производную и приравняем к 0):
$$ \Phi' = 1 + A \cdot 2(2 - x) \cdot (-1) = 1 - 2A(2 - x) = 0 $$
$$ 1 = 4A - 2Ax $$
$$ 2Ax = 4A - 1 $$
$$ x^* = \frac{4A - 1}{2A} = 2 - \frac{1}{2A} $$

**Анализ:**
*   Если $A = 1$ (штраф маленький): $x = 2 - 0.5 = 1.5$. (Нарушили границу, но выгадали в целевой функции).
*   Если $A = 10$: $x = 2 - 0.05 = 1.95$. (Почти у границы).
*   Если $A \to \infty$: $\frac{1}{2A} \to 0$, значит $x \to 2$.

Мы приближаемся к правильному ответу $x=2$ **снаружи** запретной зоны.

---

## 5. Навигация
<< [[Q20 - Метод проекции градиента]] | [[00_ПЛАН_ПОДГОТОВКИ]] | [[Q22 - Дробно-линейная задача]] >>